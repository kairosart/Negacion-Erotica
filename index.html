<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Negaci√≥n Er√≥tica ‚Äî Sistema Diario + Modo Especial</title>
<style>
body{
  background:#111;
  color:#fff;
  font-family: system-ui;
  padding:20px;
  text-align:center;
}
.card{
  background:#222;
  padding:16px;
  border-radius:10px;
  margin:10px auto;
  max-width:600px;
}
#slotContainer{
  padding:20px;
  background:#000;
  border-radius:12px;
  display:inline-block;
  margin-top:20px;
  position:relative;
  overflow:hidden;
  height:90px;
}
.grid3{
  display:grid;
  grid-template-columns:repeat(3,80px);
  grid-gap:10px;
  justify-content:center;
}
.cell{
  width:80px;
  height:80px;
  background:#333;
  border-radius:8px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:40px;
  transition: transform 0.3s;
}
button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#0af;
  color:white;
  font-weight:bold;
  cursor:pointer;
  margin:5px;
}
button:disabled{
  background:#555;
  cursor:not-allowed;
}
.modo-especial-marco{
  border:6px solid gold;
  box-shadow:0 0 20px gold, 0 0 40px goldenrod;
  animation:brilloMarco 2s infinite alternate;
}
@keyframes brilloMarco{
  0%{ box-shadow:0 0 10px gold; }
  100%{ box-shadow:0 0 35px rgb(255,215,0); }
}
.luces-arcade{
  position:relative;
}
.luces-arcade::before,
.luces-arcade::after{
  content:"";
  position:absolute;
  height:8px;
  width:100%;
  left:0;
  background:linear-gradient(
    90deg,
    red, orange, yellow, lime, cyan, blue, purple, red
  );
  background-size:400% 100%;
  animation:lucesArcade 3s linear infinite;
}
.luces-arcade::before{ top:-14px; }
.luces-arcade::after{ bottom:-14px; }
@keyframes lucesArcade{
  0%{ background-position:0%; }
  100%{ background-position:400%; }
}
#msg span.permitido{ color: lime; font-weight:bold; }
#msg span.negado{ color: red; font-weight:bold; }
#reglasModal{
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.8); color:#fff; text-align:left;
  padding:40px; overflow:auto;
}
#reglasModal button{
  margin-top:20px; background:#0af;
}
</style>
</head>
<body>
<h1>üé∞ Negaci√≥n Er√≥tica ‚Äî Sistema Diario</h1>
<audio id="modoMusica" src="arcade_theme.mp3"></audio>

<div id="slotContainer">
  <div class="grid3" id="grid"></div>
</div>
<br>
<button id="spinBtn">üé∞ Girar</button>
<button id="verVideoBtn">üé• Ver video no atractivo (+5%)</button>
<button id="resetBtn">üîÑ Reiniciar</button>
<button id="verReglasBtn">üìú Ver reglas</button>

<p id="msg"></p>
<p id="stats"></p>
<p id="racha"></p>
<p id="prob"></p>

<div class="card">
  <h3>Historial de d√≠as</h3>
  <div id="historial"></div>
</div>

<div id="reglasModal">
  <h2>Reglas del juego</h2>
  <ul>
    <li>üé∞ Solo puedes girar una vez al d√≠a.</li>
    <li>üéØ El resultado puede ser "Permitido" o "Negado".</li>
    <li>üî• Rachas de 5, 10 y 20 d√≠as consecutivos aumentan tus posibilidades.</li>
    <li>‚≠ê Al alcanzar 20 d√≠as se desbloquea el Modo Especial.</li>
    <li>üé• Puedes ver un video no atractivo para aumentar un 5% tus posibilidades una vez al d√≠a.</li>
  </ul>
  <button id="cerrarReglas">Cerrar</button>
</div>

<script>
const grid = document.getElementById("grid");
const msg = document.getElementById("msg");
const stats = document.getElementById("stats");
const probTxt = document.getElementById("prob");
const rachaTxt = document.getElementById("racha");
const historialDiv = document.getElementById("historial");
const audio = document.getElementById("modoMusica");

let modoEspecial = localStorage.getItem("modoEspecial") === "true";
let symbolsBase = ["üçí","üçã","üîî","üíé"];
let prob = parseFloat(localStorage.getItem("prob")) || 50;
let ultimoDia = localStorage.getItem("ultimoDia") || "";
let racha = parseInt(localStorage.getItem("racha")) || 0;
let historial = JSON.parse(localStorage.getItem("historialDias") || "[]");
let videoVistoHoy = localStorage.getItem("videoVistoHoy") === (new Date().toISOString().split("T")[0]);

function hoy(){ return new Date().toISOString().split("T")[0]; }

function guardar(){
  localStorage.setItem("prob", prob);
  localStorage.setItem("ultimoDia", ultimoDia);
  localStorage.setItem("racha", racha);
  localStorage.setItem("modoEspecial", modoEspecial);
  localStorage.setItem("historialDias", JSON.stringify(historial));
  localStorage.setItem("videoVistoHoy", videoVistoHoy ? hoy() : "");
}

function addHistorial(texto){
  historial.push({fecha:hoy(), texto});
  localStorage.setItem("historialDias", JSON.stringify(historial));
  renderHistorial();
}

function renderHistorial(){
  historialDiv.innerHTML = historial.map(h=>`<div>üìÖ ${h.fecha}: ${h.texto}</div>`).join("");
}

function activarModoEspecial(){
  const slot = document.getElementById("slotContainer");
  slot.classList.add("modo-especial-marco");
  slot.classList.add("luces-arcade");

  audio.loop = true;
  const playAudio = () => {
    audio.play().catch(e => console.log("Audio bloqueado hasta interacci√≥n del usuario"));
    document.removeEventListener("click", playAudio);
  };
  document.addEventListener("click", playAudio);

  modoEspecial = true;
  addHistorial("Modo Especial desbloqueado");
  guardar();
}

if(modoEspecial) activarModoEspecial();

for(let i=0;i<3;i++){
  const c=document.createElement("div"); c.className="cell"; c.id="c"+i; grid.appendChild(c);
}

function getSymbol(){
  if(modoEspecial && Math.random()<0.05) return "‚≠ê";
  return symbolsBase[Math.floor(Math.random()*symbolsBase.length)];
}

function evaluate(a,b,c){
  if(a===b && b===c){ if(a==="‚≠ê") return 999; return 100; }
  if(a===b || b===c) return 10;
  return 0;
}

function intentoDisponible(){ return ultimoDia!==hoy(); }

function actualizarRacha(){
  const ayer = new Date(); ayer.setDate(ayer.getDate()-1);
  const ayerStr = ayer.toISOString().split("T")[0];
  if(ultimoDia===ayerStr) racha++;
  else { 
    if(ultimoDia!==hoy()){ 
      racha=0; prob-=10; if(prob<0)prob=0; addHistorial("Racha rota (‚Äì10% prob.)"); 
    }
  }
  if(racha===5){ prob+=5; addHistorial("+5% por 5 d√≠as consecutivos"); }
  if(racha===10){ prob+=10; addHistorial("+10% por 10 d√≠as consecutivos"); }
  if(racha===20 && !modoEspecial) activarModoEspecial();
  guardar();
}

function girarRodillos(finalSymbols){
  const spins = 15;
  const delay = 80;
  let count = 0;
  const interval = setInterval(()=>{
    for(let i=0;i<3;i++){
      const sym = symbolsBase[Math.floor(Math.random()*symbolsBase.length)];
      document.getElementById("c"+i).textContent=sym;
    }
    count++;
    if(count>=spins){
      clearInterval(interval);
      for(let i=0;i<3;i++){
        document.getElementById("c"+i).textContent=finalSymbols[i];
      }
    }
  },delay);
}

document.getElementById("spinBtn").onclick=()=>{
  if(!intentoDisponible()){ msg.innerHTML="<span class='negado'>Hoy ya usaste tu intento.</span>"; return; }
  actualizarRacha();
  const a=getSymbol(), b=getSymbol(), c=getSymbol();
  girarRodillos([a,b,c]);
  const dado=Math.random()*100;
  if(dado<prob){ 
    msg.innerHTML=`<span class='permitido'>‚úî Permitido (${dado.toFixed(2)} < ${prob}%)</span>`; 
    addHistorial("Permitido"); 
  }
  else{ 
    msg.innerHTML=`<span class='negado'>‚úò Negado (${dado.toFixed(2)} ‚â• ${prob}%)</span>`; 
    addHistorial("Negado"); 
  }
  prob-=10; if(prob<0)prob=0;
  ultimoDia=hoy();
  guardar(); actualizarUI();
};

document.getElementById("verVideoBtn").onclick = () => {
  if(videoVistoHoy){ alert("Ya viste tu video hoy."); return; }
  const videoURL = "https://www.youtube.com/watch?v=dQw4w9WgXcQ";
  const videoWindow = window.open(videoURL,"Video","width=800,height=450");
  const checkClosed = setInterval(() => {
    if(videoWindow.closed){
      clearInterval(checkClosed);
      prob +=5; if(prob>100) prob=100;
      addHistorial("+5% por ver video no atractivo");
      videoVistoHoy = true;
      guardar();
      actualizarUI();
      msg.innerHTML="<span class='permitido'>‚úî Video completado (+5%)</span>";
    }
  },1000);
};

document.getElementById("resetBtn").onclick=()=>{
  localStorage.clear(); location.reload();
};

// Reglas modal
document.getElementById("verReglasBtn").onclick = () => {
  document.getElementById("reglasModal").style.display = "block";
};
document.getElementById("cerrarReglas").onclick = () => {
  document.getElementById("reglasModal").style.display = "none";
};

function actualizarUI(){
  stats.textContent=`Ultimo d√≠a jugado: ${ultimoDia}`;
  probTxt.textContent=`Probabilidad actual: ${prob}%`;
  rachaTxt.textContent=`Racha: ${racha} d√≠as`;
}

renderHistorial();
actualizarUI();
</script>
</body>
</html>
