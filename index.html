<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tragaperras NegaciÃ³n ErÃ³tica</title>

<style>
  body { background: #111; color: #fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; text-align: center; padding: 20px; }
  button { padding: 10px 16px; margin: 5px; border: none; border-radius: 8px; background: #0af; color: #111; font-weight: 700; cursor: pointer; }
  button:disabled { background: #555; color: #ccc; cursor: not-allowed; }
  #slotContainer { display: flex; justify-content: center; margin-top: 20px; }
  .cell { width: 82px; height: 82px; background: #222; border-radius: 8px; margin: 0 6px; display: flex; justify-content: center; align-items: center; font-size: 42px; }
  #resultadoTirada { font-size: 2em; font-weight: bold; margin-top: 20px; }
  .premio { color: #4caf50; }
  .sinPremio { color: #f44336; }
  #historialBox { background: #222; padding: 10px; border-radius: 10px; font-size: 14px; color: #eee; max-height: 240px; overflow-y: auto; }
  #calendario { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 12px; }
  .dia { background: #333; padding: 8px; border-radius: 6px; }
  .jugado { background: #0af; color: #111; font-weight: bold; }
  #modalVideo { display: none !important; position: fixed !important; z-index: 100000 !important; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.75) !important; justify-content: center; align-items: center; }
  #modalVideo .modal-content { background: #222; padding: 20px; border-radius: 10px; width: 90%; max-width: 450px; }
  table { margin: 20px auto; border-collapse: collapse; min-width: 320px; }
  th, td { border: 1px solid #0af; padding: 6px 10px; }
  th { background: #0af; color: #111; }
</style>
</head>

<body>
<h1>ğŸ° NegaciÃ³n ErÃ³tica</h1>



<div id="slotContainer">
  <div class="cell" id="c0">ğŸ’</div>
  <div class="cell" id="c1">ğŸ‹</div>
  <div class="cell" id="c2">ğŸ””</div>
</div>

<div id="resultadoTirada">ğŸ‘‰ Esperando tirada...</div>

<br/>

<button id="spinBtn">ğŸ° Girar</button>
<button id="verVideoBtn">ğŸ¥ Ver video no atractivo (+5)</button>
<button id="verReglasBtn">ğŸ“œ Reglas</button>
<button id="toggleCalendarioBtn">ğŸ“… Mostrar/Ocultar Calendario</button>
<button id="reiniciarBtn">ğŸ”„ Reiniciar</button>

<div id="calendarioBox" style="display:none;">
  <h3>ğŸ“… Calendario de progreso</h3>
  <div id="calendario"></div>
</div>

<h3>ğŸ† Tabla de Premios</h3>
<table id="tablaPremios">
  <tr><th>CombinaciÃ³n</th><th>Premio</th></tr>
</table>

<div id="estadoJuego">
  <p id="msgIntento"></p>
  <p>Ãšltimo dÃ­a jugado: <span id="ultimoDiaTxt"></span></p>
  <p>Racha: <span id="rachaTxt"></span> dÃ­as</p>
  <p>Progreso actual: <span id="progresoTxt"></span>%</p>

  <div id="historialBox">
    <h3>Historial de dÃ­as</h3>
    <div id="historialDetalles"></div>
  </div>
</div>
<!-- MODAL VIDEO -->
<div id="modalVideo">
  <div class="modal-content">
    <h2 style="text-align:center; color:#0af;">VÃ­deo</h2>
    <video id="videoNoAtractivo" controls preload="auto" style="width:100%; background:black;">
      <source src="video.mp4" type="video/mp4">
      Tu navegador no soporta video HTML5.
    </video>
    <button id="cerrarModalVideoBtn" style="width:100%; margin-top:12px;">Cerrar</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const cells = [0,1,2].map(i => document.getElementById("c"+i));
  const resultadoDiv = document.getElementById("resultadoTirada");
  const historialDiv = document.getElementById("historialDetalles");
  const calendarioDiv = document.getElementById("calendario");
  const tablaPremios = document.getElementById("tablaPremios");

  const spinBtn = document.getElementById("spinBtn");
  const verVideoBtn = document.getElementById("verVideoBtn");
  const verReglasBtn = document.getElementById("verReglasBtn");
  const toggleCalendarioBtn = document.getElementById("toggleCalendarioBtn");
  const reiniciarBtn = document.getElementById("reiniciarBtn");

  const modalVideo = document.getElementById("modalVideo");
  const cerrarModalVideoBtn = document.getElementById("cerrarModalVideoBtn");
  const videoNoAtractivo = document.getElementById("videoNoAtractivo");

  const symbolsBase = ["ğŸ’","ğŸ‹","ğŸ””","ğŸ’"];
  const premios = {"ğŸ’ğŸ’ğŸ’":"Arruinado en 1 min.","ğŸ‹ğŸ‹ğŸ‹":"Arruinado en 3 min.","ğŸ””ğŸ””ğŸ””":"Arruinado en 5 min.","ğŸ’ğŸ’ğŸ’":"Arruinado en 10 min.","â­â­â­":"Orgasmo"};

  function hoyISO(){ const d=new Date(); return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0"); }
  function hoyES(){ const d=new Date(); return d.getDate()+"/"+(d.getMonth()+1)+"/"+d.getFullYear(); }
  function formatearFecha(iso){ const [y,m,d]=iso.split("-"); return `${d}/${m}/${y}`; }

  let ultimoDia = localStorage.getItem("ultimoDia") || "";
  let ultimoVideo = localStorage.getItem("ultimoVideo") || "";
  let racha = parseInt(localStorage.getItem("racha") || "0");
  let progreso = parseInt(localStorage.getItem("progreso") || "50");
  let historial = JSON.parse(localStorage.getItem("historial") || "[]");

  function guardar(){ 
    localStorage.setItem("ultimoDia", ultimoDia); 
    localStorage.setItem("ultimoVideo", ultimoVideo); 
    localStorage.setItem("racha", racha); 
    localStorage.setItem("historial", JSON.stringify(historial)); 
    localStorage.setItem("progreso", progreso); 
  }

  function renderHistorial(){ 
    historialDiv.innerHTML = historial.map(h => `<div>ğŸ“… ${h.fecha}: ${h.texto}</div>`).join(""); 
  }

  function actualizarEstado(){
    document.getElementById("ultimoDiaTxt").textContent = ultimoDia ? formatearFecha(ultimoDia) : "Ninguno";
    document.getElementById("rachaTxt").textContent = racha;
    document.getElementById("progresoTxt").textContent = progreso;

    // DESACTIVAR BOTÃ“N GIRAR SI YA SE HIZO TIRADA
    spinBtn.disabled = (ultimoDia === hoyISO());
  }

  function renderCalendario(){
    calendarioDiv.innerHTML = "";
    const now = new Date(), y=now.getFullYear(), m=now.getMonth(), dias=new Date(y,m+1,0).getDate();
    for(let i=1;i<=dias;i++){
      const fISO = `${y}-${String(m+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;
      const jugado = historial.some(h => h.iso === fISO);
      calendarioDiv.innerHTML += `<div class="dia ${jugado?"jugado":""}">${i}</div>`;
    }
  }

  function addHistorial(texto){
    const fISO=hoyISO();
    historial.push({iso:fISO, fecha:hoyES(), texto});
    guardar();
    renderHistorial();
    actualizarEstado();
    renderCalendario();
  }

  function getSymbol(){ return symbolsBase[Math.floor(Math.random()*symbolsBase.length)]; }

  function girarRodillos(finalSymbols, callback){
    let n=15,c=0;
    const i=setInterval(()=>{
      cells.forEach(c=>c.textContent=getSymbol());
      c++;
      if(c>=n){ clearInterval(i); cells.forEach((c,i)=>c.textContent=finalSymbols[i]); callback(); }
    },80);
  }

  spinBtn.addEventListener("click", ()=>{
    if(ultimoDia===hoyISO()){ alert("Solo 1 tirada por dÃ­a."); return; }
    const s=[getSymbol(),getSymbol(),getSymbol()];
    girarRodillos(s, ()=>{
      const combo = s.join("");
      const premio = premios[combo] || null;
      resultadoDiv.textContent = premio || "Sin premio";
      resultadoDiv.className = premio?"premio":"sinPremio";
      ultimoDia = hoyISO();
      racha++;
      addHistorial(`Tirada: ${premio || "Sin premio"}`);
      spinBtn.disabled = true;
      guardar();
    });
  });

  verReglasBtn.addEventListener("click", ()=>{
    alert(`Reglas:\n- Solo 1 tirada por dÃ­a.\n- La racha aumenta cada dÃ­a jugado.\n- Si no juegas un dÃ­a, se pierde la racha.\n- Para ganar, los 3 sÃ­mbolos deben ser iguales.\n- Puedes ver el video no atractivo una vez al dÃ­a (+5% progreso).`);
  });

  toggleCalendarioBtn.addEventListener("click", ()=>{
    const box=document.getElementById("calendarioBox");
    box.style.display = box.style.display==="none"?"block":"none";
  });

  reiniciarBtn.addEventListener("click", ()=>{
    if(confirm("Â¿Seguro?")){ localStorage.clear(); location.reload(); }
  });

  verVideoBtn.addEventListener("click", ()=>{
    if(ultimoVideo===hoyISO()){ alert("Ya usaste el video hoy."); return; }
    progreso=Math.min(100,progreso+5);
    ultimoVideo=hoyISO();
    verVideoBtn.disabled=true;
    addHistorial("Video visto (+5%)");
    guardar();
    modalVideo.style.setProperty("display","flex","important");
    videoNoAtractivo.currentTime=0;
    videoNoAtractivo.play();
  });

  function cerrarVideo(){ modalVideo.style.display="none"; videoNoAtractivo.pause(); }
  cerrarModalVideoBtn.addEventListener("click", cerrarVideo);
  window.addEventListener("click", e=>{ if(e.target===modalVideo) cerrarVideo(); });

  function actualizarTablaPremios(){
    tablaPremios.innerHTML = "<tr><th>CombinaciÃ³n</th><th>Premio</th></tr>";
    Object.entries(premios).forEach(([combo, texto])=>{
      tablaPremios.innerHTML += `<tr><td>${combo}</td><td>${texto}</td></tr>`;
    });
  }

  // Render inicial
  renderHistorial();
  actualizarEstado();
  renderCalendario();
  actualizarTablaPremios();
});
</script>
</body>
</html>
