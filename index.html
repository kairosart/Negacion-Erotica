<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tragaperras NegaciÃ³n ErÃ³tica</title>
<style>
  body { background: #111; color: #fff; font-family: system-ui; text-align: center; padding: 20px; }
  button { padding: 10px 16px; margin: 5px; border: none; border-radius: 8px; background: #0af; color: #fff; font-weight: bold; cursor: pointer; }
  button:disabled { background: #555; cursor: not-allowed; }
  #slotContainer { display: flex; justify-content: center; margin-top: 20px; }
  .cell { width: 80px; height: 80px; background: #222; border-radius: 8px; margin: 0 5px; display: flex; justify-content: center; align-items: center; font-size: 40px; transition: transform 0.3s; }
  #resultadoTirada { font-size: 24px; margin-top: 15px; }
  .premio-verde { color: #0f0; font-weight: bold; }
  .premio-rojo { color: #f00; font-weight: bold; }
  #estadoJuego { margin-bottom: 20px; max-width: 700px; margin-left: auto; margin-right: auto; color: #fff; font-family: monospace; text-align: left; }
  #historialBox { background: #222; padding: 10px; border-radius: 10px; font-size: 14px; color: #eee; max-height: 220px; overflow-y: auto; margin-top: 30px; }
  #historialBox h3 { margin-top: 0; font-weight: bold; text-align: center; }
  #historialDetalles div { margin: 4px 0; }
  .premio-especial { background-color: yellow; color: #000; font-weight: bold; padding: 2px 4px; border-radius: 4px; }
</style>
</head>
<body>
<h1>ğŸ° NegaciÃ³n ErÃ³tica</h1>

<div id="estadoJuego">
  <p>Fecha: <span id="fechaTxt"></span></p>
  <p>Racha: <span id="rachaTxt"></span> dÃ­as</p>
  <p>Probabilidad actual: <span id="probabilidadTxt"></span>%</p>
</div>

<div id="slotContainer">
  <div class="cell" id="c0">ğŸ’</div>
  <div class="cell" id="c1">ğŸ‹</div>
  <div class="cell" id="c2">ğŸ””</div>
</div>

<div id="resultadoTirada">ğŸ‘‰ Esperando tirada...</div>

<br />
<button id="spinBtn">ğŸ° Girar</button>
<button id="verVideoBtn">ğŸ¥ Ver video no atractivo (+5%)</button>
<button id="verReglasBtn">ğŸ“œ Ver Reglas</button>
<button id="reiniciarBtn">ğŸ”„ Reiniciar</button>

<div id="historialBox">
  <h3>Historial de dÃ­as</h3>
  <div id="historialDetalles"></div>
</div>

<script>
/* =========================
   Estado y persistencia
========================= */
const cells = [0,1,2].map(i => document.getElementById("c"+i));
const historialDiv = document.getElementById("historialDetalles");
const fechaTxt = document.getElementById("fechaTxt");
const rachaTxt = document.getElementById("rachaTxt");
const probTxt = document.getElementById("probabilidadTxt");

let symbolsBase = ["ğŸ’","ğŸ‹","ğŸ””","ğŸ’","â­"];
let premios = {
  "ğŸ’ğŸ’ğŸ’":"Arruinado en 1 min.ğŸ’ğŸ’ğŸ’",
  "ğŸ‹ğŸ‹ğŸ‹":"Arruinado en 3 min.ğŸ‹ğŸ‹ğŸ‹",
  "ğŸ””ğŸ””ğŸ””":"Arruinado en 5 min.ğŸ””ğŸ””ğŸ””",
  "ğŸ’ğŸ’ğŸ’":"Arruinado en 10 min.ğŸ’ğŸ’ğŸ’",
  "â­â­â­":"ğŸ‰ ORGASMO!â­â­â­",
  "ğŸ’ğŸ’":"2' manipulacion dedo clit. ğŸ’ğŸ’",
  "ğŸ‹ğŸ‹":"10 azotes en las nalgas ğŸ‹ğŸ‹",
  "ğŸ””ğŸ””":"1' de rodillas con el collar y pinzas ğŸ””ğŸ””",
  "ğŸ’ğŸ’":"Miembro en vagina con estim. clit. ğŸ’ğŸ’",
  "â­â­":"2' de lengua en el clitoris â­â­"
};

let prob = parseFloat(localStorage.getItem("prob")) || 50;
let ultimoDia = localStorage.getItem("ultimoDia") || "";
let racha = parseInt(localStorage.getItem("racha")) || 0;
let historial = JSON.parse(localStorage.getItem("historialDias")||"[]");
let ultimoVideoDia = localStorage.getItem("ultimoVideoDia") || "";

/* =========================
   Funciones auxiliares
========================= */
function hoy(){ 
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const yyyy = d.getFullYear();
  return `${dd}/${mm}/${yyyy}`;
}

function guardar(){
  localStorage.setItem("prob",prob);
  localStorage.setItem("ultimoDia",ultimoDia);
  localStorage.setItem("racha",racha);
  localStorage.setItem("historialDias",JSON.stringify(historial));
  localStorage.setItem("ultimoVideoDia",ultimoVideoDia);
}

function addHistorial(texto, especial=false){
  historial.push({ fecha:hoy(), texto, especial });
  renderHistorial();
  actualizarEstadoJuego();
  guardar();
}

function renderHistorial(){
  historialDiv.innerHTML = historial.map(h => {
    const cls = h.especial ? 'premio-especial' : '';
    return `<div class="${cls}">ğŸ“… ${h.fecha}: ${h.texto}</div>`;
  }).join("");
}

function actualizarEstadoJuego(){
  fechaTxt.textContent = hoy();
  rachaTxt.textContent = racha;
  probTxt.textContent = prob.toFixed(2);
}

function getSymbol(){ return symbolsBase[Math.floor(Math.random()*symbolsBase.length)]; }

function getSymbolsModoEspecial(){
  if(racha<20) return [getSymbol(), getSymbol(), getSymbol()];
  let symbols=[];
  let probEstrella = 0;
  if(racha>=25) probEstrella=0.1;
  if(racha>=30) probEstrella=0.15;
  if(racha>=35) probEstrella=0.2;
  for(let i=0;i<3;i++){
    symbols.push(Math.random()<probEstrella ? "â­" : getSymbol());
  }
  return symbols;
}

function girarRodillos(finalSymbols){
  let spins=15, count=0;
  const interval=setInterval(()=>{
    cells.forEach(c=>c.textContent=getSymbol());
    count++;
    if(count>=spins){
      clearInterval(interval);
      cells.forEach((c,i)=>c.textContent=finalSymbols[i]);
    }
  },80);
}

/* =========================
   Evento Girar
========================= */
document.getElementById("spinBtn").addEventListener("click",()=>{
  if(ultimoDia===hoy()){ alert("Solo 1 tirada por dÃ­a."); return; }

  let s1,s2,s3, esEspecial=false;
  if(racha>=20){
    [s1,s2,s3] = getSymbolsModoEspecial();
    esEspecial = (s1==="â­" && s2==="â­" && s3==="â­");
  } else {
    [s1,s2,s3] = [getSymbol(), getSymbol(), getSymbol()];
  }

  girarRodillos([s1,s2,s3]);

  const combo = s1+s2+s3;

  let premioTexto = "Sin premio";
  let clasePremio = "premio-rojo";

  if(s1===s2 && s2===s3){
    premioTexto = premios[combo] || "Premio triple!";
    clasePremio = "premio-verde";
    prob += 0.2;
  } else if(s1===s2){
    premioTexto = premios[s1+s2] || "Premio doble!";
    clasePremio = "premio-verde";
    prob += 0.1;
  } else if(s2===s3){
    premioTexto = premios[s2+s3] || "Premio doble!";
    clasePremio = "premio-verde";
    prob += 0.1;
  } else {
    prob -= 0.05;
  }

  prob = Math.min(Math.max(prob,0),100);
  racha++;
  ultimoDia = hoy();

  document.getElementById("resultadoTirada").textContent = premioTexto;
  document.getElementById("resultadoTirada").className = clasePremio;

  addHistorial(`Tirada: ${combo} - ${premioTexto}`, esEspecial);
});

/* =========================
   BotÃ³n Ver Video (+5%)
========================= */
document.getElementById("verVideoBtn").addEventListener("click",()=>{
  if(ultimoVideoDia===hoy()){
    alert("Ya viste el video hoy. Solo una vez al dÃ­a.");
    return;
  }

  let video = document.getElementById("videoBonus");
  let cerrarBtn = document.getElementById("cerrarVideoBtn");

  if(!video){
    video = document.createElement("video");
    video.id = "videoBonus";
    video.controls = true;
    video.width = 400;
    video.style.display = "block";
    video.style.margin = "10px auto";

    const source = document.createElement("source");
    source.src = "video.mp4"; // tu archivo de video
    source.type = "video/mp4";
    video.appendChild(source);
    document.body.appendChild(video);

    cerrarBtn = document.createElement("button");
    cerrarBtn.id = "cerrarVideoBtn";
    cerrarBtn.textContent = "âŒ Cerrar video";
    cerrarBtn.style.display = "block";
    cerrarBtn.style.margin = "10px auto";
    cerrarBtn.onclick = ()=>{
      video.style.display="none";
      cerrarBtn.style.display="none";
      video.pause();
    };
    document.body.appendChild(cerrarBtn);
  }

  video.style.display="block";
  cerrarBtn.style.display="block";
  video.play();

  ultimoVideoDia = hoy();
  prob = Math.min(prob+5,100);
  addHistorial("Video visto (+5%)");
  guardar();
});

/* =========================
   BotÃ³n Reglas
========================= */
document.getElementById("verReglasBtn").addEventListener("click",()=>{
  alert(
    "Reglas:\n"+
    "- Solo 1 tirada permitida por dÃ­a.\n"+
    "- La racha incrementa en +1 cada dÃ­a que juegas.\n"+
    "- Racha 20 dÃ­as activa modo especial (sÃ­mbolo â­).\n"+
    "- Ganar: triple igual. Dobles solo si estÃ¡n juntos.\n"+
    "- La 'Probabilidad actual' sube al ganar (+0.2) y al ver el video (+5), baja al perder (âˆ’0.05)."
  );
});

/* =========================
   BotÃ³n Reiniciar
========================= */
document.getElementById("reiniciarBtn").addEventListener("click",()=>{
  if(!confirm("Se reiniciarÃ¡ todo el progreso. Â¿Continuar?")) return;
  localStorage.clear();
  historial = [];
  prob = 50;
  racha = 0;
  ultimoDia = "";
  ultimoVideoDia = "";
  document.getElementById("resultadoTirada").textContent="ğŸ‘‰ Esperando tirada...";
  document.getElementById("resultadoTirada").className="";
  renderHistorial();
  actualizarEstadoJuego();
});

/* =========================
   InicializaciÃ³n
========================= */
renderHistorial();
actualizarEstadoJuego();
document.getElementById("resultadoTirada").textContent="ğŸ‘‰ Esperando tirada...";
</script>
</body>
</html>
