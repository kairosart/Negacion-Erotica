<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ° NegaciÃ³n ErÃ³tica</title>
<style>
  /* Modo oscuro y estilos generales */
  body {
    background-color: #121212;
    color: #eee;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  h1 {
    font-weight: 900;
    font-size: 2.5rem;
  }
  h1 span {
    font-size: 3rem;
    margin-right: 8px;
  }
  #mensajeError {
    color: #ff2c2c;
    font-weight: 700;
    margin: 10px 0 20px 0;
    font-size: 1.2rem;
  }

  #info {
    margin-bottom: 20px;
    font-size: 1.1rem;
  }

  #historial {
    background-color: #1f1f1f;
    border-radius: 8px;
    padding: 15px;
    max-height: 200px;
    overflow-y: auto;
    text-align: left;
    font-family: monospace;
    margin-bottom: 25px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
  }
  #historial div {
    margin-bottom: 5px;
  }
  .premio-especial {
    color: gold;
    font-weight: 700;
  }

  #simbolos {
    margin: 25px 0;
  }
  #simbolos > button {
    font-size: 3rem;
    background: #222;
    border: none;
    margin: 0 12px;
    padding: 15px 25px;
    border-radius: 12px;
    color: white;
    cursor: default;
    user-select: none;
  }

  /* Botones azules grandes */
  .btn {
    background-color: #009cff;
    border: none;
    color: white;
    padding: 12px 25px;
    margin: 8px 6px;
    border-radius: 12px;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 0 3px 8px #006bb2aa;
    transition: background-color 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .btn:hover {
    background-color: #007bbf;
  }
  .btn:active {
    background-color: #005f94;
  }

</style>
</head>
<body>

<h1><span>ğŸ°</span>NegaciÃ³n ErÃ³tica</h1>
<div id="mensajeError" style="display:none;">Hoy <b>ya</b> usaste tu intento.</div>

<div id="info">
  <div>Ãšltimo dÃ­a jugado: <span id="ultimoDia">-</span></div>
  <div>Racha: <span id="racha">0</span> dÃ­as</div>
  <div>Probabilidad actual: <span id="probabilidad">0%</span></div>
</div>

<div id="historial">
  <!-- Historial de tiradas -->
</div>

<div id="simbolos">
  <button disabled>ğŸ’</button>
  <button disabled>ğŸ‹</button>
  <button disabled>ğŸ””</button>
</div>

<div>
  <button id="girarBtn" class="btn">ğŸ° Girar</button>
  <button id="verVideoBtn" class="btn">ğŸ¥ Ver video no atractivo (+5%)</button>
  <button id="verReglasBtn" class="btn">ğŸ“œ Ver Reglas</button>
  <button id="simularBtn" class="btn">ğŸª„ Simular 365 dÃ­as</button>
  <button id="reiniciarBtn" class="btn">ğŸ§¹ Reiniciar</button>
</div>

<script>
  // Variables principales
  let symbolsBase = ["ğŸ’", "ğŸ‹", "ğŸ””", "ğŸ’"];
  let especialSymbol = "â­";

  let probabilidadBase = 50; // prob base de salir â­ (en %)
  let probabilidadActual = parseFloat(localStorage.getItem("probabilidad")) || probabilidadBase;

  let ultimoDia = localStorage.getItem("ultimoDia") || "";
  let racha = parseInt(localStorage.getItem("racha")) || 0;
  let historial = JSON.parse(localStorage.getItem("historial") || "[]");
  let modoEspecial = true; // activado siempre por el contexto
  let combinaciones = JSON.parse(localStorage.getItem("combinaciones") || "{}");

  // Referencias DOM
  const mensajeError = document.getElementById("mensajeError");
  const ultimoDiaSpan = document.getElementById("ultimoDia");
  const rachaSpan = document.getElementById("racha");
  const probabilidadSpan = document.getElementById("probabilidad");
  const historialDiv = document.getElementById("historial");
  const simbolosBtns = [...document.querySelectorAll("#simbolos > button")];

  const girarBtn = document.getElementById("girarBtn");
  const verVideoBtn = document.getElementById("verVideoBtn");
  const verReglasBtn = document.getElementById("verReglasBtn");
  const simularBtn = document.getElementById("simularBtn");
  const reiniciarBtn = document.getElementById("reiniciarBtn");

  // Funciones auxiliares
  function hoy() {
    return new Date().toISOString().split("T")[0];
  }

  function guardarEstado() {
    localStorage.setItem("probabilidad", probabilidadActual);
    localStorage.setItem("ultimoDia", ultimoDia);
    localStorage.setItem("racha", racha);
    localStorage.setItem("historial", JSON.stringify(historial));
    localStorage.setItem("combinaciones", JSON.stringify(combinaciones));
  }

  function actualizarEstadoPantalla() {
    ultimoDiaSpan.textContent = ultimoDia || "-";
    rachaSpan.textContent = racha;
    probabilidadSpan.textContent = probabilidadActual.toFixed(2) + "%";

    // Mostrar si ya jugÃ³ hoy
    if (ultimoDia === hoy()) {
      mensajeError.style.display = "block";
      girarBtn.disabled = true;
    } else {
      mensajeError.style.display = "none";
      girarBtn.disabled = false;
    }

    // Actualizar sÃ­mbolos visibles en botones (solo visual)
    simbolosBtns.forEach((btn, i) => {
      btn.textContent = symbolsBase[i];
    });

    // Mostrar historial
    historialDiv.innerHTML = historial.map((item, idx) => {
      const diaStr = item.dia ? `DÃ­a ${item.dia}` : "";
      const esEspecial = item.especial ? "premio-especial" : "";
      const tiradaStr = item.tirada || "";
      const negacion = "âŒ NegaciÃ³n";
      return `<div class="${esEspecial}">ğŸ“… ${diaStr}: Tirada: ${tiradaStr} ${negacion}</div>`;
    }).join("");
  }

  function getSimbolo() {
    if (!modoEspecial) return symbolsBase[Math.floor(Math.random() * symbolsBase.length)];

    // Modo especial: probabilidad de estrella aumenta con racha, max 30%
    let probEstrella = 0.05 + racha * 0.01;
    if (probEstrella > 0.30) probEstrella = 0.30;

    if (Math.random() < probEstrella) return especialSymbol;
    return symbolsBase[Math.floor(Math.random() * symbolsBase.length)];
  }

  function jugarDia() {
    if (ultimoDia === hoy()) {
      alert("Ya jugaste hoy, vuelve maÃ±ana.");
      return;
    }

    // Tirada
    let s1 = getSimbolo();
    let s2 = getSimbolo();
    let s3 = getSimbolo();

    // Garantizar al menos 3 premios especiales en racha (modo especial)
    let estrellasConseguidas = Object.keys(combinaciones).filter(k => k === especialSymbol.repeat(3)).length > 0 ? combinaciones[especialSymbol.repeat(3)] : 0;
    if (modoEspecial && estrellasConseguidas < 3) {
      s1 = s2 = s3 = especialSymbol;
    }

    // Registrar combinaciÃ³n
    let combo = s1 + s2 + s3;
    combinaciones[combo] = (combinaciones[combo] || 0) + 1;

    // Actualizar sÃ­mbolos visuales (reemplazamos botones)
    simbolosBtns[0].textContent = s1;
    simbolosBtns[1].textContent = s2;
    simbolosBtns[2].textContent = s3;

    // Guardar historial con info de dÃ­a y si es especial
    let nuevoDia = historial.length ? historial[historial.length - 1].dia + 1 : 1;
    historial.push({
      dia: nuevoDia,
      tirada: combo,
      especial: combo === especialSymbol.repeat(3)
    });

    ultimoDia = hoy();
    racha++;
    guardarEstado();
    actualizarEstadoPantalla();
  }

  function verVideo() {
    probabilidadActual += 5;
    if (probabilidadActual > 100) probabilidadActual = 100;
    historial.push({dia: historial.length ? historial[historial.length - 1].dia + 1 : 1, tirada: "Video visto (+5%)", especial: false});
    guardarEstado();
    actualizarEstadoPantalla();
  }

  function verReglas() {
    alert(`Reglas:\n- Solo una tirada por dÃ­a.\n- Modo especial aumenta probabilidad de â­ segÃºn la racha.\n- Al menos 3 premios especiales â­ aparecerÃ¡n en modo especial.`);
  }

  function simular365Dias() {
    for (let i = 1; i <= 365; i++) {
      let s1 = getSimbolo();
      let s2 = getSimbolo();
      let s3 = getSimbolo();

      let estrellasConseguidas = combinaciones[especialSymbol.repeat(3)] || 0;
      if (modoEspecial && estrellasConseguidas < 3) {
        s1 = s2 = s3 = especialSymbol;
      }

      let combo = s1 + s2 + s3;
      combinaciones[combo] = (combinaciones[combo] || 0) + 1;

      historial.push({
        dia: i,
        tirada: combo,
        especial: combo === especialSymbol.repeat(3)
      });
    }
    guardarEstado();
    actualizarEstadoPantalla();
    alert("SimulaciÃ³n completada.");
  }

  function reiniciar() {
    if (confirm("Â¿Seguro que quieres reiniciar todo? Se perderÃ¡n los datos guardados.")) {
      localStorage.clear();
      location.reload();
    }
  }

  // Eventos
  girarBtn.addEventListener("click", jugarDia);
  verVideoBtn.addEventListener("click", verVideo);
  verReglasBtn.addEventListener("click", verReglas);
  simularBtn.addEventListener("click", simular365Dias);
  reiniciarBtn.addEventListener("click", reiniciar);

  // Inicializar
  actualizarEstadoPantalla();

</script>

</body>
</html>
