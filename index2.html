<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tragaperras Negaci√≥n Er√≥tica</title>

<style>
  body { background: #111; color: #fff; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; text-align: center; padding: 20px; }
  button { padding: 10px 16px; margin: 5px; border: none; border-radius: 8px; background: #0af; color: #111; font-weight: 700; cursor: pointer; }
  button:disabled { background: #555; color: #aaa; cursor: not-allowed; }
  #slotContainer { display: flex; justify-content: center; margin-top: 20px; }
  .cell { width: 82px; height: 82px; background: #222; border-radius: 8px; margin: 0 6px; display: flex; justify-content: center; align-items: center; font-size: 42px; }
  #resultadoTirada { font-size: 2em; font-weight: bold; margin-top: 20px; }
  .premio { color: #4caf50; }
  .sinPremio { color: #f44336; }
  #estadoJuego { margin-bottom: 20px; max-width: 760px; margin-left: auto; margin-right: auto; color: #fff; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; text-align: left; }
  #msgIntento { color: #ff5252; font-weight: bold; font-size: 1.05em; margin-bottom: 8px; text-align: center; }
  #historialBox { background: #222; padding: 10px; border-radius: 10px; font-size: 14px; color: #eee; max-height: 240px; overflow-y: auto; }
  #historialBox h3 { margin-top: 0; font-weight: bold; text-align: center; }
  #historialDetalles div { margin: 4px 0; }
  .premio-especial { background-color: #ffe55c; color: #000; font-weight: bold; padding: 2px 4px; border-radius: 4px; }
  #calendario { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 12px; }
  .dia { background: #333; padding: 8px; border-radius: 6px; }
  .jugado { background: #0af; color: #111; font-weight: bold; }
  table { margin: 20px auto; border-collapse: collapse; min-width: 320px; }
  th, td { border: 1px solid #0af; padding: 6px 10px; }
  th { background: #0af; color: #111; }
  #calendarioBox { display: none; }

  /* ===== MODAL ===== */
  .modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.65);
    backdrop-filter: blur(4px);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #222;
    padding: 25px;
    border-radius: 12px;
    width: 85%;
    max-width: 420px;
    text-align: left;
    color: #eee;
    border: 2px solid #0af;
    animation: aparecer 0.25s ease-out;
  }

  .modal-content h2 {
    margin-top: 0;
    text-align: center;
    color: #0af;
  }

  .cerrarBtn {
    display: block;
    width: 100%;
    margin-top: 15px;
    padding: 10px;
    background: #0af;
    color: #111;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
  }

  video {
    width: 100%;
    border-radius: 8px;
    margin-top: 10px;
  }

  @keyframes aparecer {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
</style>

</head>
<body>

<h1>üé∞ Negaci√≥n Er√≥tica</h1>

<div id="estadoJuego">
  <p id="msgIntento"></p>
  <p>√öltimo d√≠a jugado: <span id="ultimoDiaTxt"></span></p>
  <p>Racha: <span id="rachaTxt"></span> d√≠as</p>
  <p>Progreso actual: <span id="progresoTxt"></span>%</p>

  <div id="historialBox">
    <h3>Historial de d√≠as</h3>
    <div id="historialDetalles"></div>
  </div>
</div>

<div id="slotContainer">
  <div class="cell" id="c0">üçí</div>
  <div class="cell" id="c1">üçã</div>
  <div class="cell" id="c2">üîî</div>
</div>

<div id="resultadoTirada">üëâ Esperando tirada...</div>

<br>

<button id="spinBtn">üé∞ Girar</button>
<button id="verVideoBtn">üé• Ver video no atractivo (+5)</button>
<button id="verReglasBtn">üìú Ver Reglas</button>
<button id="toggleCalendarioBtn">üìÖ Mostrar/Ocultar Calendario</button>
<button id="reiniciarBtn">üîÑ Reiniciar</button>

<div id="calendarioBox">
  <h3>üìÖ Calendario de progreso</h3>
  <div id="calendario"></div>
</div>

<h3>üèÜ Tabla de Premios</h3>
<table id="tablaPremios">
  <tr><th>Combinaci√≥n</th><th>Premio</th></tr>
</table>

<!-- MODAL REGLAS -->
<div id="modalReglas" class="modal">
  <div class="modal-content">
    <h2>üìú Reglas</h2>
    <p>- Solo 1 tirada por d√≠a.</p>
    <p>- Solo 1 video no atractivo por d√≠a.</p>
    <p>- La racha aumenta cada d√≠a que juegas.</p>
    <p>- Si no juegas un d√≠a, la racha se reinicia.</p>
    <p>- Desde 20 d√≠as se activa el modo especial ‚≠ê.</p>
    <p>- Ganar: 3 s√≠mbolos iguales.</p>
    <p>- Premios: üçí=1min, üçã=3min, üîî=5min, üíé=10min, ‚≠ê=Mega premio.</p>
    <p>- Ver video no atractivo: +5% de progreso.</p>
    <button id="cerrarModalBtn" class="cerrarBtn">Cerrar</button>
  </div>
</div>

<!-- MODAL VIDEO LOCAL -->
<div id="modalVideo" class="modal">
  <div class="modal-content">
    <h2>V√≠deo</h2>
    <video id="videoNoAtractivo" controls>
      <source src="video.mp4" type="video/mp4">
      Tu navegador no soporta HTML5 video.
    </video>
    <button id="cerrarModalVideoBtn" class="cerrarBtn">Cerrar</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const cells=[0,1,2].map(i=>document.getElementById("c"+i));
const resultadoDiv=document.getElementById("resultadoTirada");
const historialDiv=document.getElementById("historialDetalles");
const calendarioDiv=document.getElementById("calendario");
const tablaPremios=document.getElementById("tablaPremios");
const calendarioBox=document.getElementById("calendarioBox");

const spinBtn=document.getElementById("spinBtn");
const verVideoBtn=document.getElementById("verVideoBtn");
const verReglasBtn=document.getElementById("verReglasBtn");
const toggleCalendarioBtn=document.getElementById("toggleCalendarioBtn");
const reiniciarBtn=document.getElementById("reiniciarBtn");

const modalReglas=document.getElementById("modalReglas");
const cerrarModalBtn=document.getElementById("cerrarModalBtn");

const modalVideo=document.getElementById("modalVideo");
const cerrarModalVideoBtn=document.getElementById("cerrarModalVideoBtn");
const videoNoAtractivo=document.getElementById("videoNoAtractivo");

function hoyISO(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`; }
function formatoBonito(f){ const [y,m,d]=f.split("-"); return `${d}/${m}/${y}`; }

const symbolsBase=["üçí","üçã","üîî","üíé"];
const premios={
  "üçíüçíüçí":"Arruinado en 1 min.",
  "üçãüçãüçã":"Arruinado en 3 min.",
  "üîîüîîüîî":"Arruinado en 5 min.",
  "üíéüíéüíé":"Arruinado en 10 min.",
  "‚≠ê‚≠ê‚≠ê":"Modo especial: üéâ Mega premio!"
};

let ultimoDia=localStorage.getItem("ultimoDia")||"";
let ultimoVideo=localStorage.getItem("ultimoVideo")||"";
let racha=parseInt(localStorage.getItem("racha")||"0");
let historial=JSON.parse(localStorage.getItem("historialDias")||"[]");
let premiosEspecialesPost20=parseInt(localStorage.getItem("premiosEspecialesPost20")||"0");
let progreso=parseInt(localStorage.getItem("progreso")||"50");

function guardar(){
  localStorage.setItem("ultimoDia",ultimoDia);
  localStorage.setItem("ultimoVideo",ultimoVideo);
  localStorage.setItem("racha",racha);
  localStorage.setItem("premiosEspecialesPost20",premiosEspecialesPost20);
  localStorage.setItem("historialDias",JSON.stringify(historial));
  localStorage.setItem("progreso",progreso);
}

function renderHistorial(){
  historialDiv.innerHTML=historial.map(h=>`<div class="${h.especial?'premio-especial':''}">üìÖ ${formatoBonito(h.fecha)}: ${h.texto}</div>`).join("");
}

function actualizarEstadoJuego(){
  const hoy=hoyISO();
  document.getElementById("msgIntento").textContent=(ultimoDia===hoy)?"Hoy ya usaste tu intento.":"";
  document.getElementById("ultimoDiaTxt").textContent=ultimoDia?formatoBonito(ultimoDia):"Ninguno";
  document.getElementById("rachaTxt").textContent=racha;
  document.getElementById("progresoTxt").textContent=progreso;

  spinBtn.disabled=(ultimoDia===hoy);
  verVideoBtn.disabled=(ultimoVideo===hoy);
}

function renderCalendario(){
  calendarioDiv.innerHTML="";
  const now=new Date();
  const year=now.getFullYear();
  const month=now.getMonth();
  const dias=new Date(year,month+1,0).getDate();
  for(let i=1;i<=dias;i++){
    const fecha=`${year}-${String(month+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`;
    const jugado=historial.some(h=>h.fecha===fecha);
    calendarioDiv.innerHTML+=`<div class="dia ${jugado?'jugado':''}">${i}</div>`;
  }
}

function actualizarTablaPremios(){
  tablaPremios.innerHTML=`<tr><th>Combinaci√≥n</th><th>Premio</th></tr>`;
  Object.entries(premios).forEach(([c,p])=>{tablaPremios.innerHTML+=`<tr><td>${c}</td><td>${p}</td></tr>`;});
}

function addHistorial(texto,especial=false){
  historial.push({fecha:hoyISO(),texto,especial});
  renderHistorial();
  actualizarEstadoJuego();
  renderCalendario();
  guardar();
}

function getSymbol(){return symbolsBase[Math.floor(Math.random()*symbolsBase.length)];}
function getSymbolsModoEspecial(){let p=0.05;if(racha>=25)p=0.10;if(racha>=30)p=0.15;if(racha>=35)p=0.20;let arr=[0,0,0].map(()=>Math.random()<p?"‚≠ê":getSymbol());if(racha>=20 && premiosEspecialesPost20<3){if(!arr.includes("‚≠ê")){arr[Math.floor(Math.random()*3)]="‚≠ê";}premiosEspecialesPost20++;}return arr;}
function getTripleOrRandom(){if(Math.random()<0.25){const s=getSymbol();return [s,s,s];}return [getSymbol(),getSymbol(),getSymbol()];}
function girarRodillos(finalArr,onFinish){let spins=15,count=0;const int=setInterval(()=>{cells.forEach(c=>c.textContent=getSymbol());if(++count>=spins){clearInterval(int);cells.forEach((c,i)=>c.textContent=finalArr[i]);onFinish();}},80);}

spinBtn.addEventListener("click",()=>{
  if(ultimoDia===hoyISO())return;
  let s=[],especial=false;
  if(racha>=20){s=getSymbolsModoEspecial();especial=s.every(x=>x==="‚≠ê");} else {s=getTripleOrRandom();}
  girarRodillos(s,()=>{
    const nombre=premios[s.join("")]||"Sin premio";
    resultadoDiv.textContent=nombre;
    resultadoDiv.className=(nombre==="Sin premio")?"sinPremio":"premio";
    racha++; ultimoDia=hoyISO(); spinBtn.disabled=true;
    addHistorial(`Tirada: ${nombre}`,especial);
  });
});

verVideoBtn.addEventListener("click", () => {
  const hoy=hoyISO();
  if(ultimoVideo===hoy){alert("Ya usaste el video hoy."); return;}
  progreso=Math.min(100,progreso+5); ultimoVideo=hoy;
  addHistorial("Video visto (+5%)"); verVideoBtn.disabled=true; guardar();

  modalVideo.style.display="flex";
  videoNoAtractivo.currentTime=0;
  videoNoAtractivo.play();
});

function cerrarVideo(){
  modalVideo.style.display="none";
  videoNoAtractivo.pause();
}

cerrarModalVideoBtn.addEventListener("click", cerrarVideo);
window.addEventListener("click",(e)=>{if(e.target===modalVideo)cerrarVideo();});

verReglasBtn.addEventListener("click",()=>modalReglas.style.display="flex");
cerrarModalBtn.addEventListener("click",()=>modalReglas.style.display="none");
window.addEventListener("click",(e)=>{if(e.target===modalReglas)modalReglas.style.display="none";});

toggleCalendarioBtn.addEventListener("click",()=>{calendarioBox.style.display=(calendarioBox.style.display==="none")?"block":"none";});

reiniciarBtn.addEventListener("click",()=>{
  if(!confirm("¬øReiniciar todo?"))return;
  localStorage.clear(); ultimoDia=""; ultimoVideo=""; racha=0; historial=[]; premiosEspecialesPost20=0; progreso=50;
  resultadoDiv.textContent="üëâ Esperando tirada..."; resultadoDiv.className="";
  renderHistorial(); actualizarEstadoJuego(); renderCalendario(); actualizarTablaPremios();
});

renderHistorial(); actualizarEstadoJuego(); renderCalendario(); actualizarTablaPremios();

});
</script>

</body>
</html>
