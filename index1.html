<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tragaperras Negaci√≥n Er√≥tica ‚Äî GitHub Pages</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:#111; color:#fff; font-family:system-ui; text-align:center; padding:20px;
}
button{
  padding:10px 16px; margin:5px; border:none; border-radius:8px; background:#0af; color:#fff; font-weight:bold; cursor:pointer;
}
button:disabled{background:#555; cursor:not-allowed;}
#slotContainer{
  display:flex; justify-content:center; margin-top:20px;
}
.cell{
  width:80px; height:80px; background:#222; border-radius:8px; margin:0 5px;
  display:flex; justify-content:center; align-items:center;
  font-size:40px; transition: transform 0.3s;
}

/* Marco especial */
.modo-especial-marco{
  border:6px solid gold; box-shadow:0 0 20px gold,0 0 40px goldenrod; animation:brilloMarco 2s infinite alternate;
}
@keyframes brilloMarco{
  0%{ box-shadow:0 0 10px gold; } 100%{ box-shadow:0 0 35px gold; }
}

/* Tarjetas */
.card{
  background:#222; padding:16px; border-radius:10px;
  margin:10px auto; max-width:600px;
}
canvas{
  background:#111; margin-top:10px; border-radius:8px;
}

/* --- NUEVO HISTORIAL MEGA AVANZADO --- */

.hist-item {
  margin: 12px 0;
  padding: 14px 18px;
  border-radius: 12px;
  font-size: 15px;
  display: flex;
  flex-direction: column;
  width: 94%;
  margin-left: auto;
  margin-right: auto;
  opacity: 0;
  transform: translateY(12px);
  animation: showHist 0.4s forwards ease-out;
}

.hist-win { background: rgba(0,255,120,0.18); border-left: 4px solid #0f0; }
.hist-lose { background: rgba(255,0,0,0.25); border-left: 4px solid #f44; }
.hist-info { background: rgba(0,150,255,0.25); border-left: 4px solid #09f; }

.hist-title {
  font-weight: bold;
  margin-bottom: 5px;
  font-size: 16px;
}

@keyframes showHist {
  to { opacity:1; transform:translateY(0); }
}
</style>
</head>

<body>

<h1>üé∞ Negaci√≥n Er√≥tica</h1>

<audio id="audioFondo" src="arcade_theme.mp3" loop></audio>
<button id="playAudioBtn">‚ñ∂Ô∏è Iniciar M√∫sica</button>

<div id="slotContainer">
  <div class="cell" id="c0">üçí</div>
  <div class="cell" id="c1">üçã</div>
  <div class="cell" id="c2">üîî</div>
</div>

<br>

<button id="spinBtn">üé∞ Girar</button>
<button id="verVideoBtn">üé• Ver video no atractivo (+5%)</button>
<button id="verReglasBtn">üìú Ver Reglas</button>
<button id="simularBtn">üß™ Simular 365 d√≠as</button>
<button id="reiniciarBtn">üîÑ Reiniciar</button>

<p id="msg"></p>
<p id="stats"></p>
<p id="racha"></p>

<div class="card">
  <h3>Historial de d√≠as</h3>
  <div id="historial"></div>
</div>

<h3>Top 10 combinaciones</h3>
<canvas id="histogramCanvas" width="600" height="300"></canvas>

<h3>Evoluci√≥n probabilidad</h3>
<canvas id="probabilidadCanvas" width="600" height="150"></canvas>

<script>

/* =========================================================
   VARIABLES PRINCIPALES
========================================================= */

const cells = [0,1,2].map(i => document.getElementById("c"+i));
const historialDiv = document.getElementById("historial");

let symbolsBase = ["üçí","üçã","üîî","üíé"];

let prob = parseFloat(localStorage.getItem("prob")) || 30;
let ultimoDia = localStorage.getItem("ultimoDia") || "";
let racha = parseInt(localStorage.getItem("racha")) || 0;
let historial = JSON.parse(localStorage.getItem("historialDias") || "[]");
let modoEspecial = localStorage.getItem("modoEspecial") === "true";

let probHistorial = JSON.parse(localStorage.getItem("probHistorial") || "[]");
let combinaciones = JSON.parse(localStorage.getItem("combinaciones") || "{}");

/* =========================================================
   HELPERS
========================================================= */

function hoy(){ return new Date().toISOString().split("T")[0]; }

function guardar(){
  localStorage.setItem("prob", prob);
  localStorage.setItem("ultimoDia", ultimoDia);
  localStorage.setItem("racha", racha);
  localStorage.setItem("modoEspecial", modoEspecial);
  localStorage.setItem("historialDias", JSON.stringify(historial));
  localStorage.setItem("probHistorial", JSON.stringify(probHistorial));
  localStorage.setItem("combinaciones", JSON.stringify(combinaciones));
}

/* =========================================================
   HISTORIAL MEGA AVANZADO
========================================================= */

function addHistorial(texto, tipo="info", data={}){
  const fecha = hoy();
  const iconos = {
    win:"üèÜ",
    lose:"‚ùå",
    info:"üîµ",
    video:"üé•",
    sim:"üß™",
    reset:"üîÑ"
  };

  const icono = iconos[tipo] || "üîµ";

  const detallesHTML = `
    <div><strong>Prob antes:</strong> ${data.probAntes ?? "?"}%</div>
    <div><strong>Prob despu√©s:</strong> ${data.probDespues ?? "?"}%</div>
    <div><strong>Racha:</strong> ${data.racha ?? "?"} d√≠as</div>
    <div><strong>Modo especial:</strong> ${data.modoEspecial ? "‚ú® S√≠" : "No"}</div>
  `;

  historial.push({
    fecha,
    texto:`${icono} ${texto}`,
    tipo,
    detalles:detallesHTML
  });

  renderHistorial();
  guardar();
}

function renderHistorial(){
  historialDiv.innerHTML = historial.map(h=>`
    <div class="hist-item hist-${h.tipo}">
      <div class="hist-title">${h.texto}</div>
      <div>üìÖ ${h.fecha}</div>
      ${h.detalles}
    </div>
  `).join("");
}

renderHistorial();

/* =========================================================
   GR√ÅFICOS
========================================================= */

let histChart, probChart;

function actualizarGraficoHistograma(){
  const ctx=document.getElementById("histogramCanvas").getContext("2d");
  let entradas=Object.entries(combinaciones).sort((a,b)=>b[1]-a[1]);
  let top10=entradas.slice(0,10);
  let labels=top10.map(e=>e[0]);
  let data=top10.map(e=>e[1]);

  if(histChart) histChart.destroy();
  histChart = new Chart(ctx,{
    type:"bar",
    data:{ labels, datasets:[{label:"Frecuencia", data, backgroundColor:"#0af"}] }
  });
}

function actualizarGraficoProbabilidad(){
  const ctx=document.getElementById("probabilidadCanvas").getContext("2d");
  if(probChart) probChart.destroy();
  probChart = new Chart(ctx,{
    type:"line",
    data:{
      labels: probHistorial.map((_,i)=>i),
      datasets:[{label:"Probabilidad (%)", data:probHistorial, borderColor:"#0af", fill:false}]
    }
  });
}

actualizarGraficoHistograma();
actualizarGraficoProbabilidad();

/* =========================================================
   SLOT
========================================================= */

function getSymbol(){
  if(modoEspecial && Math.random()<0.05) return "‚≠ê";
  return symbolsBase[Math.floor(Math.random()*symbolsBase.length)];
}

function girarRodillos(finalSymbols){
  let spins=15, count=0;
  const interval=setInterval(()=>{
    cells.forEach(c=>c.textContent=getSymbol());
    count++;
    if(count>=spins){
      clearInterval(interval);
      cells.forEach((c,i)=>c.textContent=finalSymbols[i]);
    }
  },80);
}

/* =========================================================
   BOT√ìN: GIRAR
========================================================= */

document.getElementById("spinBtn").addEventListener("click",()=>{

  const probAntes = prob;

  let s1=getSymbol(), s2=getSymbol(), s3=getSymbol();
  girarRodillos([s1,s2,s3]);
  const combo=s1+s2+s3;
  const gano=(s1===s2 && s2===s3);

  combinaciones[combo]=(combinaciones[combo]||0)+1;

  if(gano) prob+=0.2;
  else prob-=0.05;

  if(prob<0) prob=0;
  if(prob>100) prob=100;

  probHistorial.push(prob);

  if(ultimoDia!==hoy()){
    racha++;
    ultimoDia=hoy();
  }

  /* === RACHAS MEJORADAS === */
  if(racha===5) prob+=8;
  if(racha===10) prob+=15;
  if(racha>=20) modoEspecial=true;

  /* === Historial de tirada === */
  addHistorial(
    "Tirada: "+combo+(gano?" ‚Äî ¬°GANASTE!":" ‚Äî Perdiste"),
    gano?"win":"lose",
    {
      probAntes: probAntes.toFixed(2),
      probDespues: prob.toFixed(2),
      racha,
      modoEspecial
    }
  );

  guardar();
  actualizarGraficoHistograma();
  actualizarGraficoProbabilidad();
});

/* =========================================================
   BOT√ìN: VIDEO
========================================================= */

document.getElementById("verVideoBtn").addEventListener("click",()=>{
  const antes = prob;
  prob+=5; if(prob>100) prob=100;

  addHistorial("Video visto (+5%)","video",{
    probAntes: antes.toFixed(2),
    probDespues: prob.toFixed(2),
    racha,
    modoEspecial
  });

  probHistorial.push(prob);
  guardar();
  actualizarGraficoProbabilidad();
});

/* =========================================================
   BOT√ìN: REGLAS
========================================================= */

document.getElementById("verReglasBtn").addEventListener("click",()=>{
  alert("Reglas:\n- 1 tirada por d√≠a\n- Racha 5 d√≠as: +8%\n- Racha 10 d√≠as: +15%\n- Racha 20: modo especial\n- Modo especial: ‚≠ê aparece 5% de las veces");
});

/* =========================================================
   SIMULACI√ìN
========================================================= */

document.getElementById("simularBtn").addEventListener("click",()=>{

  const DIAS=365;
  let probLocal=prob;
  let rachaLocal=racha;
  let modoEspLocal=modoEspecial;
  let resultados={...combinaciones};
  let probEvol=[...probHistorial];
  let ultimoDiaSim=0;

  for(let dia=1; dia<=DIAS; dia++){
    const s1=getSymbol(), s2=getSymbol(), s3=getSymbol();
    const combo=s1+s2+s3;
    resultados[combo]=(resultados[combo]||0)+1;

    const gano=(s1===s2&&s2===s3);

    if(gano) probLocal+=0.2;
    else probLocal-=0.05;

    if(probLocal<0) probLocal=0;
    if(probLocal>100) probLocal=100;

    if(dia===ultimoDiaSim+1) rachaLocal++;
    else rachaLocal=0;

    ultimoDiaSim=dia;

    if(rachaLocal===5) probLocal+=8;
    if(rachaLocal===10) probLocal+=15;
    if(rachaLocal>=20) modoEspLocal=true;

    probEvol.push(probLocal);
  }

  prob=probLocal;
  racha=rachaLocal;
  modoEspecial=modoEspLocal;
  combinaciones=resultados;
  probHistorial=probEvol;

  addHistorial("Simulaci√≥n 365 d√≠as completada","sim",{
    probAntes:"?",
    probDespues:prob.toFixed(2),
    racha,
    modoEspecial
  });

  guardar();
  actualizarGraficoProbabilidad();
  actualizarGraficoHistograma();
});

/* =========================================================
   BOT√ìN: REINICIAR
========================================================= */

document.getElementById("reiniciarBtn").addEventListener("click",()=>{
  if(!confirm("¬øSeguro que quieres reiniciar el juego completo?")) return;

  prob=30;
  racha=0;
  modoEspecial=false;
  historial=[];
  combinaciones={};
  probHistorial=[];
  ultimoDia="";

  localStorage.clear();

  addHistorial("Juego reiniciado","reset",{
    probAntes:"?",
    probDespues:"30",
    racha:0,
    modoEspecial:false
  });

  renderHistorial();
  actualizarGraficoProbabilidad();
  actualizarGraficoHistograma();
});

/* =========================================================
   AUDIO
========================================================= */

document.getElementById("playAudioBtn").addEventListener("click",()=>{
  document.getElementById("audioFondo").play();
});

</script>

</body>
</html>