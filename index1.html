<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tragaperras Negaci√≥n Er√≥tica ‚Äî GitHub Pages</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{
  background:#111; color:#fff; font-family:system-ui; text-align:center; padding:20px;
}
button{
  padding:10px 16px; margin:5px; border:none; border-radius:8px; background:#0af; color:#fff; font-weight:bold; cursor:pointer;
}
button:disabled{background:#555; cursor:not-allowed;}
#slotContainer{
  display:flex; justify-content:center; margin-top:20px;
}
.cell{
  width:80px; height:80px; background:#222; border-radius:8px; margin:0 5px; display:flex; justify-content:center; align-items:center; font-size:40px; transition: transform 0.3s;
}
.modo-especial-marco{
  border:6px solid gold; box-shadow:0 0 20px gold,0 0 40px goldenrod; animation:brilloMarco 2s infinite alternate;
}
@keyframes brilloMarco{
  0%{ box-shadow:0 0 10px gold; } 100%{ box-shadow:0 0 35px gold; }
}
.permitido{color:limegreen; font-weight:bold;}
.negado{color:red; font-weight:bold;}
.card{background:#222; padding:16px; border-radius:10px; margin:10px auto; max-width:600px;}
canvas{background:#111; margin-top:10px; border-radius:8px;}
</style>
</head>
<body>
<h1>üé∞ Negaci√≥n Er√≥tica</h1>

<audio id="audioFondo" src="arcade_theme.mp3" loop></audio>
<button id="playAudioBtn">‚ñ∂Ô∏è Iniciar M√∫sica</button>

<div id="slotContainer">
  <div class="cell" id="c0">üçí</div>
  <div class="cell" id="c1">üçã</div>
  <div class="cell" id="c2">üîî</div>
</div>

<br>
<button id="spinBtn">üé∞ Girar</button>
<button id="verVideoBtn">üé• Ver video no atractivo (+5%)</button>
<button id="verReglasBtn">üìú Ver Reglas</button>
<button id="simularBtn">üß™ Simular 100,000 tiradas</button>
<p id="msg"></p>
<p id="stats"></p>
<p id="racha"></p>

<div class="card">
  <h3>Historial de d√≠as</h3>
  <div id="historial"></div>
</div>

<h3>Top 10 combinaciones</h3>
<canvas id="histogramCanvas" width="600" height="300"></canvas>

<h3>Evoluci√≥n probabilidad</h3>
<canvas id="probabilidadCanvas" width="600" height="150"></canvas>

<script>
const cells = [0,1,2].map(i=>document.getElementById("c"+i));
const msg = document.getElementById("msg");
const stats = document.getElementById("stats");
const rachaTxt = document.getElementById("racha");
const historialDiv = document.getElementById("historial");

let symbolsBase = ["üçí","üçã","üîî","üíé"];
let prob = parseFloat(localStorage.getItem("prob"))||50;
let ultimoDia = localStorage.getItem("ultimoDia")||"";
let racha = parseInt(localStorage.getItem("racha"))||0;
let historial = JSON.parse(localStorage.getItem("historialDias")||"[]");
let videoVistoHoy = localStorage.getItem("videoVistoHoy")===new Date().toISOString().split("T")[0];
let modoEspecial = localStorage.getItem("modoEspecial")==="true";

function hoy(){ return new Date().toISOString().split("T")[0]; }
function guardar(){ 
  localStorage.setItem("prob", prob);
  localStorage.setItem("ultimoDia", ultimoDia);
  localStorage.setItem("racha", racha);
  localStorage.setItem("modoEspecial", modoEspecial);
  localStorage.setItem("historialDias", JSON.stringify(historial));
  localStorage.setItem("videoVistoHoy", videoVistoHoy?hoy():"");
}
function addHistorial(texto){
  historial.push({fecha:hoy(), texto});
  guardar();
  renderHistorial();
}
function renderHistorial(){
  historialDiv.innerHTML = historial.map(h=>`<div>üìÖ ${h.fecha}: ${h.texto}</div>`).join("");
}
function intentoDisponible(){ return ultimoDia!==hoy(); }
function actualizarRacha(){
  const ayer = new Date(); ayer.setDate(ayer.getDate()-1);
  const ayerStr = ayer.toISOString().split("T")[0];
  if(ultimoDia===ayerStr) racha++;
  else if(ultimoDia!==hoy()){ racha=0; prob-=10; if(prob<0)prob=0; addHistorial("Racha rota (‚Äì10% prob.)"); }
  if(racha===5){ prob+=5; addHistorial("+5% por 5 d√≠as consecutivos"); }
  if(racha===10){ prob+=10; addHistorial("+10% por 10 d√≠as consecutivos"); }
  if(racha>=20 && !modoEspecial) activarModoEspecial();
  guardar();
}
function activarModoEspecial(){
  document.getElementById("slotContainer").classList.add("modo-especial-marco");
  modoEspecial=true;
  addHistorial("Modo Especial desbloqueado");
}
function getSymbol(){ return modoEspecial && Math.random()<0.05?"‚≠ê":symbolsBase[Math.floor(Math.random()*symbolsBase.length)]; }
function girarRodillos(finalSymbols){
  let spins=15, count=0;
  let interval = setInterval(()=>{
    cells.forEach(c=>c.textContent=symbolsBase[Math.floor(Math.random()*symbolsBase.length)]);
    count++;
    if(count>=spins){ clearInterval(interval); cells.forEach((c,i)=>c.textContent=finalSymbols[i]); }
  },80);
}
function actualizarUI(){ stats.textContent=`Ultimo d√≠a jugado: ${ultimoDia}`; rachaTxt.textContent=`Racha: ${racha} d√≠as`; }

document.getElementById("spinBtn").onclick=()=>{
  if(!intentoDisponible()){ msg.innerHTML="<span class='negado'>Hoy ya usaste tu intento.</span>"; return; }
  actualizarRacha();
  let symbols = [getSymbol(),getSymbol(),getSymbol()];
  girarRodillos(symbols);
  let dado=Math.random()*100;
  if(dado<prob){ msg.innerHTML=`<span class='permitido'>‚úî Permitido (${dado.toFixed(2)} < ${prob}%)</span>`; addHistorial("Permitido"); }
  else{ msg.innerHTML=`<span class='negado'>‚úò Negado (${dado.toFixed(2)} ‚â• ${prob}%)</span>`; addHistorial("Negado"); }
  prob-=10; if(prob<0)prob=0;
  ultimoDia=hoy();
  guardar(); actualizarUI();
};

document.getElementById("verVideoBtn").onclick=()=>{
  if(videoVistoHoy){ alert("Ya viste tu video hoy."); return; }
  const videoWindow = window.open("https://www.youtube.com/watch?v=dQw4w9WgXcQ","Video","width=800,height=450");
  const checkClosed = setInterval(()=>{
    if(videoWindow.closed){ clearInterval(checkClosed); prob+=5; if(prob>100)prob=100; videoVistoHoy=true; guardar(); actualizarUI(); addHistorial("+5% por video completado"); msg.innerHTML="<span class='permitido'>‚úî Video completado (+5%)</span>"; }
  },1000);
};

document.getElementById("verReglasBtn").onclick=()=>{ alert(`Reglas:\n1Ô∏è‚É£ Solo un intento por d√≠a.\n2Ô∏è‚É£ Video aumenta probabilidad +5%.\n3Ô∏è‚É£ Rachas: 5 d√≠as +5%, 10 d√≠as +10%, 20 d√≠as desbloquea Modo Especial.\n4Ô∏è‚É£ Jackpot: tres ‚≠ê\n5Ô∏è‚É£ Probabilidad m√°xima 100%`); };

document.getElementById("playAudioBtn").onclick=()=>{ document.getElementById("audioFondo").play(); };

document.getElementById("simularBtn").onclick=()=>{
  const tiradas=100000; let permitido=0, negado=0, jackpots=0, rachaSim=0, maxRachaSim=0, probSim=50;
  let combos={}, probHistory=[];
  for(let i=0;i<tiradas;i++){
    let a=symbolsBase[Math.floor(Math.random()*4)], b=symbolsBase[Math.floor(Math.random()*4)], c=symbolsBase[Math.floor(Math.random()*4)];
    if(Math.random()<0.05){ a=b=c="‚≠ê"; jackpots++; }
    combos[a+b+c]=(combos[a+b+c]||0)+1;
    let dado=Math.random()*100;
    if(dado<probSim){ permitido++; rachaSim++; } else { negado++; if(rachaSim>maxRachaSim) maxRachaSim=rachaSim; rachaSim=0; probSim-=10; if(probSim<0)probSim=0; }
    if(rachaSim===5) probSim+=5; if(rachaSim===10) probSim+=10; if(rachaSim>=20) probSim+=15; if(probSim>100)probSim=100;
    probHistory.push(probSim);
  } if(rachaSim>maxRachaSim) maxRachaSim=rachaSim;

  addHistorial(`Simulaci√≥n ${tiradas} tiradas: Permitido ${permitido}, Negado ${negado}, Jackpots ${jackpots}, Racha m√°xima ${maxRachaSim}, Prob final ${probSim.toFixed(2)}%`);

  // Gr√°fico combinaciones top10
  const ctx = document.getElementById("histogramCanvas").getContext("2d");
  const top10 = Object.entries(combos).sort((a,b)=>b[1]-a[1]).slice(0,10);
  new Chart(ctx,{type:'bar', data:{labels:top10.map(e=>e[0]), datasets:[{label:'Frecuencia', data:top10.map(e=>e[1]), backgroundColor:'lime'}]}, options:{responsive:true, plugins:{legend:{display:false}}}});

  // Gr√°fico evoluci√≥n probabilidad
  const ctx2 = document.getElementById("probabilidadCanvas").getContext("2d");
  const sampledProb = probHistory.filter((_,i)=>i%1000===0);
  new Chart(ctx2,{type:'line', data:{labels:sampledProb.map((_,i)=>i*1000), datasets:[{label:'Probabilidad', data:sampledProb, borderColor:'yellow', backgroundColor:'transparent'}]}, options:{responsive:true, plugins:{legend:{display:false}}}});
};

renderHistorial();
actualizarUI();
</script>
</body>
</html>
